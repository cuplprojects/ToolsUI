import pandas as pd
import os

# Ask for Excel file path
input_file = input("Enter the full path of your Excel file: ").strip().strip('"')
if not os.path.exists(input_file):
print("❌ File not found. Check path.")
exit()

# Output file
folder = os.path.dirname(input_file)
output_file = os.path.join(folder, "output_hr_to_vr_all_sheets.xlsx")

xls = pd.ExcelFile(input_file)

# Use ExcelWriter to save multiple sheets
with pd.ExcelWriter(output_file, engine = 'xlsxwriter') as writer:
for sheet_name in xls.sheet_names:
  print(f"Processing sheet: {sheet_name}")
df = pd.read_excel(xls, sheet_name = sheet_name)

main_cols = ['EXAM_CENTER', 'DISTRICT', 'COLLEG']
center_cols = [col for col in df.columns if str(col).isnumeric()]
        
        # Keep only relevant columns
df = df[[col for col in main_cols + center_cols if col in df.columns]]

all_rows = []
        
        # Process row by row
for idx, row in df.iterrows():
  for center in center_cols:
    count_value = row.get(center, "")
if pd.isna(count_value):
  count_value = ""
all_rows.append({
  "EXAM_CENTER": row["EXAM_CENTER"],
  "DISTRICT": row["DISTRICT"],
  "COLLEG": row["COLLEG"],
  "CENTER": center,
  "COUNT": count_value
})
        
        # Convert to DataFrame
output_df = pd.DataFrame(all_rows)
        
        # Make safe sheet name
safe_sheet_name = "".join(c if c.isalnum() or c in " _-" else "_" for c in sheet_name)
        
        # Save to ExcelWriter
output_df.to_excel(writer, sheet_name = safe_sheet_name, index = False)
print(f"✅ Sheet '{sheet_name}' processed, rows: {len(output_df)}")

print(f"\n✅ All sheets saved in one Excel file: {output_file}")